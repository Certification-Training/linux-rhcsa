# Booting, Updating Kernel and Logging Messages

The Kernel controls everything on the Linux system. `systemd` is the default system inititialization scheme in RHEL7 replacing init and Upstart.

The boot process on an x86 computer can be split into 4 main phases: Firmware phase, Boot loader phase, Kernel phase & Initialization phase

* The firmware is the BIOS or the UEFI code that is stored in flash memory on the x86 system board. The first thing that it does is run the power-on-self-test (POST) to detect, test and initialize the system hardware componenets
* When it discovers a boot device, it loads GRUB2 into memory and passes control over to it
* GRUB2 is loaded into memory and takes control, it searches for the kernel in `/boot` file system
* The configuration can be seen in `/boot/grub2/grub.cfg` 

```bash
  # see the defined GRUB behavior
  /etc/default/grub
  # reproduce the grub.cfg file
  grub2-mkconfig -o /boot/grub2/grub.cfg
  grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg
```

#### Managing GRUB

* After the firmware phase the bootloader presents a menu with a list of bootable kernels. Pressing a key allows the autoboot process to be stopped to interact with GRUB

#### Resetting the Root User Password

```bash
  # interact with GRUB as shown above
  # find boot string that starts with linux16 and append
  init=/sysroot/bin/sh
  # enters emergency mode
  chroot /sysroot
  # remounte root file system in read/write mode
  mount -o remount,rw /
  # enter a new password
  passwd
  # create an empty hidden file called .autorelabel at the root of the directory tree to instruct the system to perform SELinux relabelling
  exit
  reboot
```

#### Linux Kernel

```bash
  # determine the Kernel version
  uname -r
  # view currently loaded modules
  lsmod
  # see detail about a module
  modinfo kvm
  # see info about kernel
  cat /proc/version
  # see infomation about a moduke
  modinfo dm_mirror
```

#### init and Upstart

The init program is the first process that spawns in the userland at system boot. It serves as the root process for all processes. init was enhanced in UNIX System V with run levels. Upstart was introduced in RHEL6 but was replaced by systemd in RHEL7. 

#### systemd

`systemd` is short for system daemon. It improves system init and state transitioning by introducing parrallel processing of startup scripts, improved handling of service dependencies, and an on-demend activation of service daemons using sockets and D-Bus. 

systemd creates sockets for all enabled services that support sock-based activation instantaneously at the very beginning of the initialization process, and passes them to daemon processes as theh attempts to start in parrallel. 

* Socket is a communication method that allows a single process running on a system to talk to another processes on the same or remote system
* D-Bus is another communication method that allows mutliple services running in parallel on a system to talk to one another on the same or remote system

```bash
yum install psmisc
# see pstree
pstree -pu
```

#### Units

Units are systemd objects that used for organizing boot and maintenance taks. systemctl is the primary command for interaction with systemd.

```bash
  # list all known units and their status
  systemctl
  # see units of type socket
  systemctl -t mount --all
  # see loaded and active targets
  systemctl -t target
```

Targets are logical collection of units. They are a special systemd unit type with the .target file extension. 


```bash
  # list all units of type socket
  systemctl list-sockets
  # lit unit files
  systemctl list-unit-files
  # check the status of atd
  systemctl status atd
  # list dependencies
  systemctl list-dependencies atd
  # show details for the atd service
  systemctl show atd
  # view time spent by each task during the boot process
  systemd-analyze blame
```

#### System Logging

System logging (syslog) captures messages generated by the kernel, daemons, commands etc. The daemon responsible is called rsyslogd. 